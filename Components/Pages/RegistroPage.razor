@page "/registro"
@inject NavigationManager nav;
@using ModelosBD;
@using Services;

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-lg-10 col-md-12 col-sm-12">
            <div class="card shadow-lg">
                <div class="card-body">
                    <h3 class="card-title text-center mb-4">Registrarse</h3>
                    <form id="registrationForm">
                        <!-- Personal Information -->
                        <div class="mb-3">
                            <label for="name" class="form-label">Nombre</label>
                            <input type="text" class="form-control" id="name" @bind=nombre placeholder="Escribe tu nombre" required />
                        </div>
                        <div class="mb-3">
                            <label for="apellido" class="form-label">Apellido</label>
                            <input type="text" class="form-control" id="apellido" @bind=ape placeholder="Escribe tu apellido" required />
                        </div>
                        <div class="mb-3">
                            <label for="email" class="form-label">Email</label>
                            <input type="email" class="form-control" id="email" @bind=email placeholder="Escribe tu email" required />
                        </div>
                        <div class="mb-3">
                            <label for="usuario" class="form-label">Usuario</label>
                            <input type="usuario" class="form-control" id="usuario" @bind=user placeholder="Escribe un usuario" required />
                        </div>
                        <div class="mb-3">
                            <label for="contrasena" class="form-label">Contraseña</label>
                            <input type="contrasena" class="form-control" id="contrasena" @bind=con placeholder="Escribe una contraseña" required />
                        </div>

                        <!-- Submit Button -->
                        <div class="text-center">
                            <button type="submit" class="btn btn-primary btn-lg" @onclick="registrarse">Registrarse</button>
                            <div id="formFeedback" class="mt-3"></div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@code {
    UsuarioService UsuarioService = new UsuarioService(new HttpClient());
    string nombre;
    string ape;
    string email;
    string user;
    string con;
    int random;


    public async Task registrarse()
    {
        if (nombre.Length == 0 || ape.Length == 0 || email.Length == 0 || user.Length == 0 || con.Length == 0)
        {
            await App.Current!.MainPage!.DisplayAlert("Error", "Datos incompletos.", "OK");
        }
        else
        {
            random = new Random().Next(1, 39);
            UsuarioDB temp=new UsuarioDB();
            temp.usuario1 = user;
            temp.contrasena = con;
            temp.nombre = nombre;
            temp.apellido = ape;
            temp.email = email;
            temp.idIdioma = 1;
            temp.idImagen = random;
            temp.id = 0;
            var que= await UsuarioService.Add(temp);
            await App.Current!.MainPage!.DisplayAlert("Registro", "Usuario registrado con éxito.", "OK");
            nav.NavigateTo("/",true);

        }     
    }
}
